grammar prodest.es.gov.br.dsl.NestDsl with 
                                      org.eclipse.xtext.common.Terminals
 
generate nestdsl "http://www.prodest.es.gov.br/dsl/NestDsl"
 
Domainmodel:
    (elements+=AbstractElement)*
    ;
    
AbstractElement:
    Type | DtoType
    ;
 
Type:
	DataType | Entity
	;

DtoType:
	DataType | Dto
	;

Entity:
    'entity' name=ID ('extends' superType=[Entity|QualifiedName])? '{'
        (properties += Property)*
        (methods += Method)*
    '}'
    ;
	
Dto:
	'dto' name=ID  ('extends' superType=[Dto|QualifiedName])? '{'
		(properties += DtoProperty)*
	'}'
	;
	
DataType:
    'type' name=ID('[]')?(';')?
    ;

QualifiedName:
   ID
   ;
 
Property:
	relation = (Relation)?
    name=ID ':' type=[Type|QualifiedName](array='[]')?(';')?
    ;
    
DtoProperty:
    name=ID ':' type=[DtoType|QualifiedName](array='[]')?(';')?
    ;
    
Relation:
	( oneArgument = OneArgumentRelation | multipleArgument =  MultipleArgumentRelation )
	;
	
OneArgumentRelation:
	argument = ('OneToOne' | 'ManyToMany' ) type=[Entity]
	;


MultipleArgumentRelation:
	argument = ('ManyToOne' | 'OneToMany') type=[Entity]',' secondArgument = ARGUMENTREGEX
	;
	
	
terminal ARGUMENTREGEX:
	('a'..'z' | 'A'..'Z' | '_')('a'..'z' | 'A'..'Z' | '_' | '0'..'9')*'=>'('a'..'z' | 'A'..'Z' | '_')('a'..'z' | 'A'..'Z' | '_' | '0'..'9')*'.'('a'..'z' | 'A'..'Z' | '_')('a'..'z' | 'A'..'Z' | '_' | '0'..'9')*
	;

Method:
	verb=( 'Get' | 'Post' | 'Delete' | 'Put' ) name=ID '(' (args+= MethodArg(',')?)* '):' returnType=[Type|QualifiedName](array='[]')?(';')?
	;
	
MethodArg:
	name=ID ':' type=[Type|QualifiedName](array='[]')?
;


